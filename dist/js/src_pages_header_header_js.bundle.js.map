{"version":3,"file":"js/src_pages_header_header_js.bundle.js","mappings":"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","sources":["webpack://bookstore-webpack/./src/assets/js/book.js","webpack://bookstore-webpack/./src/assets/js/cart.js","webpack://bookstore-webpack/./src/pages/header/header.js"],"sourcesContent":["import { books,Book,BookType,BookTypes } from './data.js';\r\n\r\n/**\r\n * \r\n * @returns {Array<BookType>}\r\n */\r\nexport function findAllBookTypes() {\r\n\r\n    let bookTypes = JSON.parse(window.sessionStorage.getItem('bookTypes'));\r\n\r\n    if(bookTypes ==null) {\r\n        // @ts-ignore\r\n        window.sessionStorage.setItem('bookTypes', JSON.stringify(Object.values(BookTypes)));\r\n        bookTypes = JSON.parse(window.sessionStorage.getItem('bookTypes'));\r\n    } \r\n\r\n    // 轉型成Booktype\r\n    bookTypes = bookTypes.map(bookType => new BookType(bookType.typeId, bookType.typeName,bookType.color));\r\n\r\n    return bookTypes;\r\n}\r\n\r\n/**\r\n * \r\n * @param {string} typeName \r\n * @returns {BookType | null}\r\n */\r\nexport function findBookTypeByTypeName(typeName) {\r\n\r\n    let bookTypes = findAllBookTypes().filter(bt => bt.typeName == typeName);\r\n\r\n    return bookTypes.length == 1 ? bookTypes[0]: null;\r\n}\r\n\r\n/**\r\n * \r\n * @returns {Array<Book>}\r\n */\r\nexport function findAllBooks() {\r\n    return getBooks();\r\n}\r\n\r\n/**\r\n * \r\n * @param {number} bookId \r\n * @returns  {Book | null}\r\n */\r\nexport function findBookById(bookId) {\r\n\r\n    const findBook = getBooks().filter(book => book.id == bookId);\r\n\r\n    return findBook.length == 0 ? null: findBook[0];\r\n}\r\n\r\n/**\r\n * \r\n * @param {Array<Book>} books \r\n * @param {number} bookId \r\n * @returns { Book | null }\r\n */\r\nexport function findBookByBooksAndId(books,bookId) {\r\n\r\n    const findBook = books.filter(book => book.id == bookId);\r\n\r\n    return findBook.length == 0 ? null: findBook[0];\r\n}\r\n\r\n/**\r\n * \r\n * @param {string} bookTypeName \r\n * @returns {Array<Book>}\r\n */\r\nexport function findBooksByTypeName(bookTypeName) {\r\n    return getBooks().filter(book => book.type.typeName == bookTypeName);\r\n}\r\n\r\n/**\r\n * \r\n * @param {number} bookId \r\n * @param {number} qty \r\n * @returns {string}\r\n */\r\nexport function minusBookSotckByBookId(bookId, qty) {\r\n   let books = getBooks();\r\n   let message = '';\r\n   books.filter(book => book.id == bookId).forEach(book=> {\r\n        if(book.stockQty - qty < 0) {\r\n            message = `${book.name} 已經無庫存`;\r\n        } else {\r\n            book.stockQty = book.stockQty - qty;\r\n        }\r\n   });\r\n\r\n   if(message == '')saveBooks(books);\r\n   return message;\r\n}\r\n\r\n/**\r\n * \r\n * @param { Book } updateBook\r\n * @returns { number }\r\n */\r\nexport function saveBook(updateBook) {\r\n    let books = getBooks();\r\n    try {\r\n        let existingBook = findBookByBooksAndId(books, updateBook.id);\r\n        if(existingBook == null) {\r\n            throw Error(`Not Found: Book Id - ${updateBook.id}`);\r\n        }\r\n        Object.assign(existingBook, updateBook);\r\n\r\n        if(existingBook.stockQty < 0 ) {\r\n            throw Error(`Stock Qty Error: Book Id - ${updateBook.id}`);\r\n        }\r\n\r\n        saveBooks(books);\r\n        return 1;\r\n    } catch (error) {\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * \r\n * @param {number} bookId \r\n * @returns { number }\r\n */\r\nexport function deleteBookById(bookId) {\r\n    let books = getBooks();\r\n    try {\r\n        let existingBook = findBookByBooksAndId(books, bookId);\r\n        if(existingBook == null) {\r\n            throw Error(`Not Found: Book Id - ${bookId}`);\r\n        }\r\n        books = books.filter(book=> book.id != bookId);\r\n        saveBooks(books);\r\n        return 1;\r\n    } catch (error) {\r\n        throw error;\r\n    }\r\n    return 1;\r\n}\r\n\r\n/**\r\n * \r\n * @param {Array<Book>} books \r\n */\r\nfunction saveBooks(books) {\r\n    window.sessionStorage.setItem('books', JSON.stringify([...books]));\r\n}\r\n\r\n/**\r\n * \r\n * @returns {Array<Book>}\r\n */\r\nfunction getBooks() {\r\n\r\n    let sessionBooks = JSON.parse(window.sessionStorage.getItem('books'));\r\n\r\n    if(sessionBooks ==null) {\r\n        saveBooks(books);\r\n        sessionBooks = JSON.parse(window.sessionStorage.getItem('books'));\r\n    } \r\n\r\n    [...sessionBooks].map(book=> {\r\n        // @ts-ignore\r\n        Object.setPrototypeOf(book, Book.prototype);\r\n    });\r\n\r\n    return sessionBooks;\r\n}","import { findAllBooks,findBookById,minusBookSotckByBookId } from './book.js';\r\n\r\nexport function addToCart(bookId) {\r\n    \r\n    let message = minusBookSotckByBookId(bookId,1);\r\n    if(message !==''){\r\n      alert(message);\r\n      return;\r\n    }\r\n\r\n    alert(`已加入購物車${bookId}`);\r\n    let cartItems = findAllCartItems();\r\n    cartItems.push(bookId);\r\n    window.sessionStorage.setItem('cartItems',cartItems.join(','));\r\n    window.location.reload();\r\n}\r\n\r\nexport function findAllCartItems() {\r\n  let cartItems = window.sessionStorage.getItem('cartItems') ==null? \"\":window.sessionStorage.getItem('cartItems');\r\n  cartItems = cartItems == '' ? []: cartItems.split(',');\r\n  return cartItems;\r\n}","import '@/styles.css';\r\nimport _ from 'lodash';\r\nimport { getSessionUser,logout,isAdmin } from '@/assets/js/user.js';\r\nimport { findAllCartItems } from '@/assets/js/cart.js';\r\n\r\nconst currentUser = getSessionUser();\r\n\r\nconsole.log(currentUser);\r\n\r\ndocument.querySelector('#username').textContent = currentUser.username;\r\ndocument.querySelector('#cartItemsCtn').textContent = findAllCartItems().length + '';\r\ndocument.querySelector('#logout').addEventListener('click',function(){\r\n    logout();\r\n});\r\n\r\nif(currentUser.role.roleId == 1) {\r\n    document.querySelector('#backBtn').classList.toggle('hidden');\r\n}\r\n\r\ndocument.querySelector('#backBtn').addEventListener('click',function() {\r\n    if(isAdmin()) {\r\n        window.location.href='./back.html';\r\n    }\r\n});"],"names":["findAllBookTypes","bookTypes","JSON","parse","window","sessionStorage","getItem","setItem","stringify","Object","values","BookTypes","map","bookType","BookType","typeId","typeName","color","findBookTypeByTypeName","filter","bt","length","findAllBooks","getBooks","findBookById","bookId","findBook","book","id","findBookByBooksAndId","books","findBooksByTypeName","bookTypeName","type","minusBookSotckByBookId","qty","message","forEach","stockQty","name","saveBooks","saveBook","updateBook","existingBook","Error","assign","error","deleteBookById","sessionBooks","setPrototypeOf","Book","prototype","addToCart","alert","cartItems","findAllCartItems","push","join","location","reload","split","currentUser","getSessionUser","console","log","document","querySelector","textContent","username","addEventListener","logout","role","roleId","classList","toggle","isAdmin","href"],"sourceRoot":""}